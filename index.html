<!DOCTYPE html>
* Yukiharu Software - Full-width to Half-width Converter
*
* Core Logic:
* 1. ASCII: Convert 0xFF01-0xFF5E to 0x21-0x7E. Convert 0x3000 (Ideographic Space) to 0x0020 (Space).
* 2. Katakana: Map Full-width Katakana to Half-width Katakana.
* - Handles Voiced (Dakuten) and Semi-voiced (Handakuten) by decomposing them into two characters.
* - Example: ガ (Ga) -> ｶ (Ka) + ﾞ (Dakuten)
*/

// Full-width to Half-width Katakana Mapping Table
const KATAKANA_MAP = {
'。': '｡', '、': '､', '「': '｢', '」': '｣', '・': '･', 'ー': 'ｰ',
'ァ': 'ｧ', 'ア': 'ｱ', 'ィ': 'ｨ', 'イ': 'ｲ', 'ゥ': 'ｩ', 'ウ': 'ｳ', 'ェ': 'ｪ', 'エ': 'ｴ', 'ォ': 'ｫ', 'オ': 'ｵ',
'カ': 'ｶ', 'ガ': 'ｶﾞ', 'キ': 'ｷ', 'ギ': 'ｷﾞ', 'ク': 'ｸ', 'グ': 'ｸﾞ', 'ケ': 'ｹ', 'ゲ': 'ｹﾞ', 'コ': 'ｺ', 'ゴ': 'ｺﾞ',
'サ': 'ｻ', 'ザ': 'ｻﾞ', 'シ': 'ｼ', 'ジ': 'ｼﾞ', 'ス': 'ｽ', 'ズ': 'ｽﾞ', 'セ': 'ｾ', 'ゼ': 'ｾﾞ', 'ソ': 'ｿ', 'ゾ': 'ｿﾞ',
'タ': 'ﾀ', 'ダ': 'ﾀﾞ', 'チ': 'ﾁ', 'ヂ': 'ﾁﾞ', 'ッ': 'ｯ', 'ツ': 'ﾂ', 'ヅ': 'ﾂﾞ', 'テ': 'ﾃ', 'デ': 'ﾃﾞ', 'ト': 'ﾄ', 'ド': 'ﾄﾞ',
'ナ': 'ﾅ', 'ニ': 'ﾆ', 'ヌ': 'ﾇ', 'ネ': 'ﾈ', 'ノ': 'ﾉ',
'ハ': 'ﾊ', 'バ': 'ﾊﾞ', 'パ': 'ﾊﾟ', 'ヒ': 'ﾋ', 'ビ': 'ﾋﾞ', 'ピ': 'ﾋﾟ', 'フ': 'ﾌ', 'ブ': 'ﾌﾞ', 'プ': 'ﾌﾟ', 'ヘ': 'ﾍ', 'ベ': 'ﾍﾞ',
'ペ': 'ﾍﾟ', 'ホ': 'ﾎ', 'ボ': 'ﾎﾞ', 'ポ': 'ﾎﾟ',
'マ': 'ﾏ', 'ミ': 'ﾐ', 'ム': 'ﾑ', 'メ': 'ﾒ', 'モ': 'ﾓ',
'ヤ': 'ﾔ', 'ユ': 'ﾕ', 'ヨ': 'ﾖ',
'ャ': 'ｬ', 'ュ': 'ｭ', 'ョ': 'ｮ',
'ラ': 'ﾗ', 'リ': 'ﾘ', 'ル': 'ﾙ', 'レ': 'ﾚ', 'ロ': 'ﾛ',
'ワ': 'ﾜ', 'ヲ': 'ｦ', 'ン': 'ﾝ',
'ヴ': 'ｳﾞ', 'ヵ': 'ｶ', 'ヶ': 'ｹ', // Rare characters
'゛': 'ﾞ', '゜': 'ﾟ' // Standalone voiced marks
};

/**
* Converts a string containing Full-width characters to Half-width.
* @param {string} str - The input string.
* @returns {string} - The converted string.
*/
function toHankaku(str) {
if (!str) return "";

let result = "";
for (let i = 0; i < str.length; i++) { const char=str[i]; const code=char.charCodeAt(0); // 1. ASCII Range (Full-width
    alphanumeric & symbols) // Range: 0xFF01 (!) to 0xFF5E (~) -> 0x21 to 0x7E
    if (code >= 0xFF01 && code <= 0xFF5E) { result +=String.fromCharCode(code - 0xFEE0); } // 2. Ideographic Space
        (Full-width space) // 0x3000 -> 0x0020
        else if (code === 0x3000) {
        result += " ";
        }
        // 3. Katakana Mapping
        else if (KATAKANA_MAP[char]) {
        result += KATAKANA_MAP[char];
        }
        // 4. Keep original character (Kanji, Hiragana, etc.)
        else {
        result += char;
        }
        }
        return result;
        }

        // DOM Elements
        const inputText = document.getElementById('input-text');
        const outputText = document.getElementById('output-text');
        const convertBtn = document.getElementById('convert-btn');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');

        // Toast Notification Helper
        function showToast(message, isError = false) {
        toast.textContent = message;
        toast.className = isError ? 'error show' : 'show';
        setTimeout(() => {
        toast.className = toast.className.replace('show', '');
        }, 3000);
        }

        // Event Listener: Convert
        convertBtn.addEventListener('click', () => {
        try {
        const input = inputText.value;
        if (input.length === 0) {
        showToast("텍스트를 입력해주세요. (テキストを入力してください)", true);
        return;
        }

        const converted = toHankaku(input);
        outputText.value = converted;

        // Optional: Log to console for debugging
        console.log("Conversion successful");
        } catch (error) {
        console.error("Conversion failed:", error);
        showToast("변환 중 오류가 발생했습니다. (エラーが発生しました)", true);
        }
        });

        // Event Listener: Copy
        copyBtn.addEventListener('click', () => {
        const textToCopy = outputText.value;
        if (!textToCopy) {
        showToast("복사할 내용이 없습니다. (コピーする内容がありません)", true);
        return;
        }

        navigator.clipboard.writeText(textToCopy).then(() => {
        showToast("복사되었습니다! (コピーしました！)");
        }).catch(err => {
        console.error('Failed to copy: ', err);
        // Fallback for older browsers or if permission denied
        outputText.select();
        document.execCommand('copy');
        showToast("복사되었습니다! (コピーしました！)");
        });
        });

        /*
        * Test Cases & Examples (For verification)
        *
        * Input: カ）ピータースラボ
        * Expected: ｶ)ﾋﾟｰﾀｰｽﾗﾎﾞ
        *
        * Input: （株）ピータースラボ
        * Expected: (株)ﾋﾟｰﾀｰｽﾗﾎﾞ
        *
        * Input: ＡＢＣ１２３
        * Expected: ABC123
        *
        * Input: ガンダム
        * Expected: ｶﾞﾝﾀﾞﾑ
        */
        </script>

        </body>

        </html>